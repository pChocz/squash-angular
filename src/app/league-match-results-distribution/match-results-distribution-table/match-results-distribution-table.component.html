<div *ngIf="matchResultDistribution.league"
     class="col justify-content-center m-2">
    <mat-expansion-panel>
        <mat-expansion-panel-header>
            <mat-panel-title>
                {{'stats.setResults.seasonFilter' | translate}}
            </mat-panel-title>
        </mat-expansion-panel-header>
        <mat-checkbox (ngModelChange)="onChange(season.seasonNumber, $event)"
                      *ngFor="let season of matchResultDistribution.league.seasons"
                      [ngModel]="selectionMap.get(season.seasonNumber)"
                      class="ms-0 me-3 text-nowrap"
                      color="primary">
            {{season.seasonNumber}}
        </mat-checkbox>
    </mat-expansion-panel>
</div>

<div class="material-frame-no-margin overflow-auto m-1">

    <table [dataSource]="dataSource"
           mat-table
           matSort
           matSortStart="desc">

        <ng-container matColumnDef="player-left" sticky>
            <th *matHeaderCellDef
                class="text-nowrap px-1 font-normal-weight color-even"
                mat-header-cell>
                <div class="text-end">
                    {{'player.looser' | translate}} →
                </div>
                <div class="text-start">
                    ↓ {{'player.winner' | translate}}
                </div>
            </th>
            <td *matCellDef="let row"
                class="text-start text-nowrap px-1 font-normal-weight color-even"
                mat-cell>
                {{row.player.emoji}} {{row.player.username}}
            </td>
            <th *matFooterCellDef
                class="text-center text-nowrap px-1 fw-bolder font-normal-weight color-even"
                mat-footer-cell>
                TOTAL −
            </th>
        </ng-container>

        <ng-container *ngFor="let item of displayedColumns.slice(1, -1); let i = index" matColumnDef="{{item}}">
            <th *matHeaderCellDef
                class="text-center text-nowrap p-2 fw-bolder left-border auto-height font-normal-weight"
                mat-header-cell>
                <div>
                    {{findPlayerByUsername(item).emoji}}
                </div>
                <div>
                    {{findPlayerByUsername(item).username}}
                </div>
            </th>
            <td *matCellDef="let row"
                class="text-center text-nowrap p-1 left-border"
                [ngClass]="row.player.username === item && 'color-even'"
                [ngStyle]="{'background-color': calculateColor(row, item)}"
                mat-cell>
                <div *ngIf="row.player.username === item">
                    <mat-icon class="large-icon empty-icon"
                              fontSet="material-symbols-rounded">
                        close
                    </mat-icon>
                </div>
                <div *ngIf="row.findResultsForOpponent(findPlayerByUsername(item)); let results">
                    <div *ngFor="let result of results.matchesResultCountList">
                        <span class="align-bottom">{{result.matchResult.result}}</span>
                        <span class="ms-1 small-grey">{{result.matchesWon}}/{{result.matchesLost + result.matchesWon}}</span>
                    </div>
                    <span class="ms-1 small-grey" *ngIf="results.matchesRatio === 1">100%</span>
                    <span class="ms-1 small-grey" *ngIf="results.matchesRatio === 0">0%</span>
                    <span class="ms-1 small-grey" *ngIf="results.matchesRatio > 0 && results.matchesRatio < 1">{{100 * results.matchesRatio | number : '1.1-1'}}%</span>
                    <mat-icon [routerLink]="['/head-to-head', row.player.uuid, findPlayerByUsername(item).uuid]"
                              class="icon-button small-grey ms-2"
                              fontSet="material-symbols-rounded"
                              matTooltip="h2h: {{row.player.username}} vs. {{item}}">
                        group
                    </mat-icon>
                </div>
            </td>
            <th *matFooterCellDef
                class="text-center text-nowrap px-2 fw-bolder left-border"
                mat-footer-cell>
                <div>
                    {{countLostMatchesForPlayer(item)}}
                </div>
                <div class="small-grey">
                    {{100 - 100 * countRatioForPlayer(item) | number : '1.1-1'}}%
                </div>
            </th>
        </ng-container>

        <ng-container matColumnDef="total">
            <th *matHeaderCellDef
                class="text-center text-nowrap px-1 left-border font-normal-weight color-even"
                mat-header-cell>
                TOTAL +
            </th>
            <td *matCellDef="let row"
                class="text-center text-nowrap px-1 left-border color-even"
                mat-cell>
                {{row.matchesWon}}
                <div class="small-grey">
                    {{100 * row.matchesRatio | number : '1.1-1'}}%
                </div>
            </td>
            <th *matFooterCellDef
                class="text-center text-nowrap px-2 fw-bolder left-border color-even"
                mat-footer-cell>
                {{countAllMatchesWon()}}
            </th>
        </ng-container>

        <tr *matHeaderRowDef="displayedColumns; sticky: true"
            mat-header-row>
        </tr>

        <tr *matRowDef="let row; columns: displayedColumns;"
            mat-row>
        </tr>

        <tr *matFooterRowDef="displayedColumns"
            mat-footer-row>
        </tr>

    </table>

</div>
